<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Stick Fight</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      font-family: 'Arial', sans-serif;
      background: #87CEEB;
    }

    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(to bottom, #87CEEB 0%, #B3E5FC 60%, #8BC34A 100%);
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    /* === HEALTH UI === */
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      z-index: 100;
      pointer-events: none;
    }
    .healthBox {
      background: rgba(0,0,0,0.7);
      padding: 8px 12px;
      border-radius: 12px;
      min-width: 110px;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    .name {
      color: white;
      font-weight: bold;
      font-size: 13px;
      text-align: center;
      margin-bottom: 4px;
      text-shadow: 1px 1px 2px #000;
    }
    .barBg {
      height: 14px;
      background: #111;
      border-radius: 7px;
      overflow: hidden;
      border: 1.5px solid rgba(255,255,255,0.3);
    }
    .bar {
      height: 100%;
      width: 100%;
      background: #4CAF50;
      transition: width 0.3s ease;
      border-radius: 6px;
    }
    .bar.red { background: #F44336; }

    /* === CONTROLS === */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      gap: 15px;
      z-index: 100;
    }
    .btn {
      width: 70px;
      height: 70px;
      background: rgba(0,0,0,0.8);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 11px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      border: 3px solid rgba(255,255,255,0.3);
      backdrop-filter: blur(10px);
    }
    .btn:active {
      transform: scale(0.92);
      background: rgba(0,0,0,1);
    }
    .icon {
      font-size: 22px;
      margin-bottom: 2px;
    }

    /* === JOYSTICK === */
    #joystick {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 120px;
      height: 120px;
      z-index: 100;
    }
    .base {
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      border-radius: 50%;
      position: relative;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      border: 3px solid rgba(255,255,255,0.3);
    }
    .knob {
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.95);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      transition: none;
    }

    /* === GAME OVER === */
    #gameOver {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      color: white;
      padding: 25px 35px;
      border-radius: 18px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      display: none;
      z-index: 200;
      box-shadow: 0 15px 40px rgba(0,0,0,0.7);
      border: 3px solid #4CAF50;
      max-width: 85vw;
    }
    #restart {
      margin-top: 15px;
      padding: 12px 28px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(76,175,80,0.5);
    }
    #restart:active {
      transform: scale(0.96);
    }

    /* === RESPONSIVE === */
    @media (orientation: landscape) and (max-height: 500px) {
      #ui { top: 8px; left: 8px; right: 8px; }
      .name { font-size: 11px; }
      .barBg { height: 11px; }
      #controls { bottom: 12px; left: 12px; gap: 10px; }
      .btn { width: 55px; height: 55px; font-size: 9px; }
      .icon { font-size: 18px; }
      #joystick { bottom: 12px; right: 12px; width: 95px; height: 95px; }
      .knob { width: 40px; height: 40px; }
      #gameOver { padding: 18px 25px; font-size: 18px; }
      #restart { padding: 10px 22px; font-size: 15px; }
    }

    @media (max-width: 400px) {
      .btn { width: 60px; height: 60px; }
      #joystick { width: 105px; height: 105px; }
      .knob { width: 45px; height: 45px; }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="canvas"></canvas>

    <!-- Health -->
    <div id="ui">
      <div class="healthBox">
        <div class="name">PLAYER 1</div>
        <div class="barBg"><div id="p1" class="bar"></div></div>
      </div>
      <div class="healthBox">
        <div class="name">PLAYER 2</div>
        <div class="barBg"><div id="p2" class="bar red"></div></div>
      </div>
    </div>

    <!-- Controls -->
    <div id="controls">
      <div class="btn" id="punch"><div class="icon">Fist</div><div>PUNCH</div></div>
      <div class="btn" id="kick"><div class="icon">Foot</div><div>KICK</div></div>
    </div>

    <!-- Joystick -->
    <div id="joystick">
      <div class="base">
        <div class="knob" id="knob"></div>
      </div>
    </div>

    <!-- Game Over -->
    <div id="gameOver">
      <div id="winner">PLAYER 1 MENANG!</div>
      <button id="restart">MAIN LAGI</button>
    </div>
  </div>

  <!-- Audio (Base64 - No external link) -->
  <audio id="punchSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>
  <audio id="kickSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>
  <audio id="hitSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const punchBtn = document.getElementById('punch');
    const kickBtn = document.getElementById('kick');
    const knob = document.getElementById('knob');
    const gameOver = document.getElementById('gameOver');
    const winnerText = document.getElementById('winner');
    const restartBtn = document.getElementById('restart');

    // Resize
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      game.groundY = canvas.height - 130;
      game.p1.y = game.groundY;
      game.p2.y = game.groundY;
      game.p2.x = canvas.width - 200;
    }
    resize();
    window.addEventListener('resize', resize);
    window.addEventListener('orientationchange', () => setTimeout(resize, 100));

    // Game State
    const game = {
      p1: { x: 150, y: 0, health: 100, face: 'right', punch: 0, kick: 0 },
      p2: { x: 0, y: 0, health: 100, face: 'left', punch: 0, kick: 0 },
      joy: { active: false, dx: 0, dy: 0 },
      particles: [],
      over: false,
      groundY: 0
    };

    // Particles
    class P { constructor(x,y,vx,vy,l,c){this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.l=l;this.c=c;} update(){this.x+=this.vx;this.y+=this.vy;this.vy+=0.5;this.l--;} draw(){ctx.globalAlpha=this.l/20;ctx.fillStyle=this.c;ctx.fillRect(this.x,this.y,4,4);ctx.globalAlpha=1;} }

    // Draw Stickman
    function draw(p, color) {
      const {x, y, face, punch, kick} = p;
      ctx.strokeStyle = color;
      ctx.lineWidth = 5;
      ctx.lineCap = 'round';

      const h = y - 80, b = y - 10;

      // Head
      ctx.beginPath(); ctx.arc(x, h, 22, 0, Math.PI*2); ctx.stroke();

      // Body
      ctx.beginPath(); ctx.moveTo(x, h+22); ctx.lineTo(x, b); ctx.stroke();

      // Arms
      let a = punch > 0 ? (face==='right' ? -1.8 + punch*0.06 : 1.8 - punch*0.06) : 0.3;
      ctx.beginPath(); ctx.moveTo(x, y-45); ctx.lineTo(x + (face==='right'?35:-35)*Math.cos(a), y-45 + 35*Math.sin(a)); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, y-45); ctx.lineTo(x + (face==='right'?-25:25), y-25); ctx.stroke();

      // Legs
      let kleg = kick > 0 ? (face==='right' ? 40 - kick : -40 + kick) : 0;
      ctx.beginPath(); ctx.moveTo(x, b); ctx.lineTo(x-20, y+20); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, b); ctx.lineTo(x+20 + kleg, y+25); ctx.stroke();
    }

    // Hit
    function hit(a, d) {
      return Math.abs(a.x - d.x) < 100 && (a.punch > 8 || a.kick > 10);
    }

    // Impact
    function impact(x, y, face) {
      for(let i=0; i<8; i++){
        const ang = face==='right' ? Math.random()*0.8-0.4 : Math.PI + Math.random()*0.8-0.4;
        const spd = 4 + Math.random()*5;
        game.particles.push(new P(x + (face==='right'?30:-30), y-50, Math.cos(ang)*spd, Math.sin(ang)*spd-2, 20, '#ff9800'));
      }
      document.getElementById('hitSfx').play();
    }

    // Update Health
    function updateHealth() {
      document.getElementById('p1').style.width = game.p1.health + '%';
      document.getElementById('p2').style.width = game.p2.health + '%';
    }

    // Game Loop
    function loop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Ground
      ctx.fillStyle = '#8BC34A';
      ctx.fillRect(0, game.groundY + 50, canvas.width, 100);

      // Particles
      game.particles = game.particles.filter(p => { p.update(); p.draw(); return p.l > 0; });

      // P1 Move
      if (game.joy.active && !game.over) {
        game.p1.x += game.joy.dx * 4;
        if (game.joy.dx) game.p1.face = game.joy.dx > 0 ? 'right' : 'left';
        game.p1.x = Math.max(70, Math.min(canvas.width-70, game.p1.x));
      }

      // P2 AI
      if (!game.over) {
        const diff = game.p1.x - game.p2.x;
        if (Math.abs(diff) > 120) {
          game.p2.x += diff > 0 ? 2 : -2;
          game.p2.face = diff > 0 ? 'right' : 'left';
        }
        if (Math.abs(diff) < 100 && Math.random() < 0.03 && game.p2.punch === 0) {
          game.p2.punch = 30;
          document.getElementById('punchSfx').play();
          if (hit(game.p2, game.p1)) { game.p1.health = Math.max(0, game.p1.health - 16); impact(game.p1.x, game.p1.y, game.p2.face); updateHealth(); }
        }
        if (Math.abs(diff) < 110 && Math.random() < 0.02 && game.p2.kick === 0) {
          game.p2.kick = 35;
          document.getElementById('kickSfx').play();
          if (hit(game.p2, game.p1)) { game.p1.health = Math.max(0, game.p1.health - 22); impact(game.p1.x, game.p1.y, game.p2.face); updateHealth(); }
        }
      }

      // Anim
      if (game.p1.punch > 0) game.p1.punch--;
      if (game.p1.kick > 0) game.p1.kick--;
      if (game.p2.punch > 0) game.p2.punch--;
      if (game.p2.kick > 0) game.p2.kick--;

      // Draw
      draw(game.p1, '#2196F3');
      draw(game.p2, '#F44336');

      // Game Over
      if (game.p1.health <= 0 || game.p2.health <= 0) {
        if (!game.over) {
          game.over = true;
          winnerText.textContent = game.p1.health <= 0 ? 'PLAYER 2 MENANG!' : 'PLAYER 1 MENANG!';
          gameOver.style.display = 'block';
        }
      }

      requestAnimationFrame(loop);
    }

    // Controls
    punchBtn.addEventListener('touchstart', e => { e.preventDefault(); if (!game.over && game.p1.punch === 0) { game.p1.punch = 30; document.getElementById('punchSfx').play(); if (hit(game.p1, game.p2)) { game.p2.health = Math.max(0, game.p2.health - 18); impact(game.p2.x, game.p2.y, game.p1.face); updateHealth(); } } });
    kickBtn.addEventListener('touchstart', e => { e.preventDefault(); if (!game.over && game.p1.kick === 0) { game.p1.kick = 35; document.getElementById('kickSfx').play(); if (hit(game.p1, game.p2)) { game.p2.health = Math.max(0, game.p2.health - 25); impact(game.p2.x, game.p2.y, game.p1.face); updateHealth(); } } });

    // Joystick
    let joyCenter = {};
    document.getElementById('joystick').addEventListener('touchstart', e => {
      e.preventDefault();
      game.joy.active = true;
      const rect = e.target.getBoundingClientRect();
      joyCenter = { x: rect.left + 60, y: rect.top + 60 };
    });

    document.addEventListener('touchmove', e => {
      if (game.joy.active) {
        const t = e.touches[0];
        const dx = t.clientX - joyCenter.x;
        const dy = t.clientY - joyCenter.y;
        const dist = Math.min(45, Math.hypot(dx, dy));
        const ang = Math.atan2(dy, dx);
        game.joy.dx = dist/45 * Math.cos(ang);
        game.joy.dy = dist/45 * Math.sin(ang);
        knob.style.transform = `translate(${dx*0.8}px, ${dy*0.8}px)`;
      }
    });

    document.addEventListener('touchend', () => {
      if (game.joy.active) {
        game.joy.active = false;
        game.joy.dx = 0;
        knob.style.transform = 'translate(-50%, -50%)';
      }
    });

    // Restart
    restartBtn.onclick = () => {
      game.p1.health = game.p2.health = 100;
      game.p1.x = 150; game.p2.x = canvas.width - 200;
      game.p1.punch = game.p1.kick = game.p2.punch = game.p2.kick = 0;
      game.particles = [];
      game.over = false;
      updateHealth();
      gameOver.style.display = 'none';
    };

    // Start
    updateHealth();
    loop();
  </script>
</body>
</html>
