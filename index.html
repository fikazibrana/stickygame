<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Stick Fight â€“ Fullscreen & Safe Zone</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; overflow:hidden; background:#87CEEB; font-family:Arial,Helvetica,sans-serif; touch-action:none; }
    
    #wrapper {
      position:relative; width:100vw; height:100vh;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(to bottom, #87CEEB 0%, #B3E5FC 60%, #8BC34A 100%);
    }
    canvas { background:#B3E5FC; display:block; }

    /* START SCREEN */
    #startScreen {
      position:absolute; inset:0; background:rgba(0,0,0,0.92);
      color:#fff; display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:35px; z-index:1000;
    }
    #startScreen h1 { font-size:50px; text-shadow:0 4px 12px rgba(0,0,0,0.7); }
    #startBtn {
      padding:22px 55px; font-size:30px; font-weight:bold;
      background:#4CAF50; color:#fff; border:none; border-radius:18px;
      cursor:pointer; box-shadow:0 10px 30px rgba(0,0,0,0.5);
      transition:transform 0.15s;
    }
    #startBtn:active { transform:scale(0.94); }

    /* FULLSCREEN BUTTON */
    #fullscreenBtn {
      position:absolute; top:15px; right:15px; z-index:1100;
      background:rgba(0,0,0,0.7); color:#fff; border:none; padding:10px 14px;
      border-radius:50%; font-size:20px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    #fullscreenBtn:active { transform:scale(0.9); }

    /* HEALTH UI - SAFE ZONE */
    #ui {
      position:absolute; top:calc(5vh + 10px); left:5vw; right:5vw;
      display:flex; justify-content:space-between; z-index:100; pointer-events:none;
    }
    .healthBox {
      background:rgba(0,0,0,0.78); padding:12px 18px; border-radius:16px;
      min-width:160px; backdrop-filter:blur(10px); box-shadow:0 6px 18px rgba(0,0,0,0.45);
    }
    .pName { color:#fff; font-weight:bold; font-size:16px; text-align:center; margin-bottom:7px; text-shadow:1px 1px 3px #000; }
    .barBg { height:20px; background:#111; border-radius:10px; overflow:hidden; border:2px solid rgba(255,255,255,0.35); }
    .bar { height:100%; width:100%; transition:width 0.35s ease; border-radius:8px; }
    .bar.green { background:linear-gradient(90deg, #4CAF50, #8BC34A); }
    .bar.red   { background:linear-gradient(90deg, #F44336, #FF5722); }

    /* CONTROLS - SAFE ZONE */
    #controls {
      position:absolute; bottom:calc(8vh + 20px); left:6vw; display:flex; gap:25px; z-index:100;
    }
    .btn {
      width:90px; height:90px; background:rgba(0,0,0,0.88); border-radius:50%;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      color:#fff; font-weight:bold; font-size:14px; box-shadow:0 10px 32px rgba(0,0,0,0.65);
      border:4px solid rgba(255,255,255,0.4); backdrop-filter:blur(12px);
      transition:transform 0.12s, background 0.12s;
    }
    .btn:active { transform:scale(0.88); background:rgba(0,0,0,1); }
    .icon { font-size:30px; margin-bottom:4px; }

    /* JOYSTICK - SAFE ZONE */
    #joystick {
      position:absolute; bottom:calc(8vh + 20px); right:6vw; width:160px; height:160px; z-index:100;
    }
    .base {
      width:100%; height:100%; background:rgba(0,0,0,0.48); border-radius:50%;
      position:relative; box-shadow:0 10px 32px rgba(0,0,0,0.55);
      border:4px solid rgba(255,255,255,0.4);
    }
    .knob {
      width:68px; height:68px; background:rgba(255,255,255,0.98); border-radius:50%;
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      box-shadow:0 8px 25px rgba(0,0,0,0.55); transition:none;
    }

    /* GAME OVER */
    #gameOver {
      position:absolute; inset:0; background:rgba(0,0,0,0.96);
      display:none; flex-direction:column; align-items:center; justify-content:center;
      color:#fff; font-size:36px; font-weight:bold; z-index:1000; gap:30px;
    }
    #restartBtn {
      padding:18px 45px; background:#4CAF50; color:#fff; border:none;
      border-radius:16px; font-size:24px; cursor:pointer; box-shadow:0 8px 25px rgba(76,175,80,0.7);
    }
    #restartBtn:active { transform:scale(0.95); }

    /* RESPONSIVE SAFE ZONE */
    @media (max-height:600px), (max-width:1000px) {
      #startScreen h1 { font-size:38px; }
      #startBtn { padding:18px 45px; font-size:26px; }
      #ui { top:calc(4vh + 8px); left:4vw; right:4vw; }
      .pName { font-size:14px; }
      .barBg { height:16px; }
      #controls { bottom:calc(6vh + 15px); left:5vw; gap:18px; }
      .btn { width:70px; height:70px; font-size:12px; }
      .icon { font-size:24px; }
      #joystick { bottom:calc(6vh + 15px); right:5vw; width:125px; height:125px; }
      .knob { width:52px; height:52px; }
      #gameOver { font-size:28px; gap:22px; }
      #restartBtn { padding:14px 35px; font-size:20px; }
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <canvas id="canvas" width="1920" height="1080"></canvas>

    <!-- FULLSCREEN BUTTON -->
    <button id="fullscreenBtn" title="Fullscreen">Fullscreen</button>

    <!-- START SCREEN -->
    <div id="startScreen">
      <h1>STICK FIGHT</h1>
      <button id="startBtn">MULAI</button>
    </div>

    <!-- HEALTH UI -->
    <div id="ui">
      <div class="healthBox"><div class="pName">PLAYER 1</div><div class="barBg"><div id="p1" class="bar green"></div></div></div>
      <div class="healthBox"><div class="pName">PLAYER 2</div><div class="barBg"><div id="p2" class="bar red"></div></div></div>
    </div>

    <!-- CONTROLS -->
    <div id="controls">
      <div class="btn" id="punch"><div class="icon">Punch</div><div>PUNCH</div></div>
      <div class="btn" id="kick"><div class="icon">Kick</div><div>KICK</div></div>
    </div>

    <!-- JOYSTICK -->
    <div id="joystick"><div class="base"><div class="knob" id="knob"></div></div></div>

    <!-- GAME OVER -->
    <div id="gameOver">
      <div id="winner">PLAYER 1 MENANG!</div>
      <button id="restartBtn">MAIN LAGI</button>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="punchSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>
  <audio id="kickSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>
  <audio id="hitSfx" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBA=="></audio>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startScreen = document.getElementById('startScreen');
    const startBtn = document.getElementById('startBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const ui = document.getElementById('ui');
    const controls = document.getElementById('controls');
    const joystick = document.getElementById('joystick');
    const gameOver = document.getElementById('gameOver');
    const winnerText = document.getElementById('winner');
    const restartBtn = document.getElementById('restartBtn');
    const punchBtn = document.getElementById('punch');
    const kickBtn = document.getElementById('kick');
    const knob = document.getElementById('knob');

    // FULLSCREEN
    function goFullscreen() {
      const elem = document.documentElement;
      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    }
    fullscreenBtn.onclick = goFullscreen;

    // RESIZE CANVAS (1920x1080)
    function resize() {
      const ratio = 1920 / 1080;
      const w = window.innerWidth, h = window.innerHeight;
      let scale = Math.min(w / 1920, h / 1080);
      canvas.style.width = (1920 * scale) + 'px';
      canvas.style.height = (1080 * scale) + 'px';
    }
    resize();
    window.addEventListener('resize', resize);
    window.addEventListener('orientationchange', () => setTimeout(resize, 100));

    // GAME STATE
    const game = {
      p1: { x: 500, y: 0, health: 100, face: 'right', punch: 0, kick: 0 },
      p2: { x: 0, y: 0, health: 100, face: 'left', punch: 0, kick: 0 },
      joy: { active: false, dx: 0 },
      particles: [],
      over: false,
      groundY: 1080 - 170
    };
    game.p1.y = game.p2.y = game.groundY;
    game.p2.x = 1920 - 600;

    // PARTICLE
    class P {
      constructor(x, y, vx, vy, l, c) { this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.l=l; this.c=c; }
      update() { this.x+=this.vx; this.y+=this.vy; this.vy+=0.7; this.l--; }
      draw() { ctx.globalAlpha = this.l/25; ctx.fillStyle=this.c; ctx.fillRect(this.x,this.y,6,6); ctx.globalAlpha=1; }
    }

    // DRAW STICKMAN
    function draw(p, color) {
      const {x, y, face, punch, kick} = p;
      ctx.strokeStyle = color; ctx.lineWidth = 8; ctx.lineCap = 'round';
      const head = y - 90, body = y - 15;

      ctx.beginPath(); ctx.arc(x, head, 28, 0, Math.PI*2); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, head+28); ctx.lineTo(x, body); ctx.stroke();

      let a = punch > 0 ? (face==='right' ? -2.0 + punch*0.07 : 2.0 - punch*0.07) : 0.3;
      ctx.beginPath(); ctx.moveTo(x, y-50);
      ctx.lineTo(x + (face==='right'?45:-45)*Math.cos(a), y-50 + 45*Math.sin(a)); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, y-50); ctx.lineTo(x + (face==='right'?-32:32), y-28); ctx.stroke();

      let kleg = kick > 0 ? (face==='right' ? 50 - kick : -50 + kick) : 0;
      ctx.beginPath(); ctx.moveTo(x, body); ctx.lineTo(x-25, y+25); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x, body); ctx.lineTo(x+25 + kleg, y+30); ctx.stroke();
    }

    function hit(a, d) { return Math.abs(a.x - d.x) < 130 && (a.punch > 10 || a.kick > 12); }

    function impact(x, y, face) {
      for (let i = 0; i < 11; i++) {
        const ang = face === 'right' ? Math.random()*1-0.5 : Math.PI + Math.random()*1-0.5;
        const s = 6 + Math.random()*8;
        game.particles.push(new P(x + (face==='right'?40:-40), y-60, Math.cos(ang)*s, Math.sin(ang)*s-3, 26, '#ff9800'));
      }
      const hit = document.getElementById('hitSfx'); hit.currentTime = 0; hit.play();
    }

    function upd() {
      document.getElementById('p1').style.width = game.p1.health + '%';
      document.getElementById('p2').style.width = game.p2.health + '%';
    }

    function loop() {
      ctx.clearRect(0, 0, 1920, 1080);
      ctx.fillStyle = '#8BC34A';
      ctx.fillRect(0, game.groundY + 80, 1920, 170);
      game.particles = game.particles.filter(p => { p.update(); p.draw(); return p.l > 0; });

      if (game.joy.active && !game.over) {
        game.p1.x += game.joy.dx * 6;
        if (game.joy.dx) game.p1.face = game.joy.dx > 0 ? 'right' : 'left';
        game.p1.x = Math.max(100, Math.min(1920 - 100, game.p1.x));
      }

      if (!game.over) {
        const diff = game.p1.x - game.p2.x;
        if (Math.abs(diff) > 150) { game.p2.x += diff > 0 ? 3 : -3; game.p2.face = diff > 0 ? 'right' : 'left'; }
        if (Math.abs(diff) < 120 && Math.random() < 0.04 && game.p2.punch === 0) {
          game.p2.punch = 30; document.getElementById('punchSfx').play();
          if (hit(game.p2, game.p1)) { game.p1.health = Math.max(0, game.p1.health - 19); impact(game.p1.x, game.p1.y, game.p2.face); upd(); }
        }
        if (Math.abs(diff) < 130 && Math.random() < 0.03 && game.p2.kick === 0) {
          game.p2.kick = 35; document.getElementById('kickSfx').play();
          if (hit(game.p2, game.p1)) { game.p1.health = Math.max(0, game.p1.health - 27); impact(game.p1.x, game.p1.y, game.p2.face); upd(); }
        }
      }

      ['p1', 'p2'].forEach(pl => { if (game[pl].punch > 0) game[pl].punch--; if (game[pl].kick > 0) game[pl].kick--; });
      draw(game.p1, '#2196F3'); draw(game.p2, '#F44336');

      if (game.p1.health <= 0 || game.p2.health <= 0) {
        if (!game.over) {
          game.over = true;
          winnerText.textContent = game.p1.health <= 0 ? 'PLAYER 2 MENANG!' : 'PLAYER 1 MENANG!';
          gameOver.style.display = 'flex';
        }
      }

      requestAnimationFrame(loop);
    }

    // CONTROLS
    punchBtn.addEventListener('touchstart', e => { e.preventDefault();
      if (!game.over && game.p1.punch === 0) {
        game.p1.punch = 30; document.getElementById('punchSfx').play();
        if (hit(game.p1, game.p2)) { game.p2.health = Math.max(0, game.p2.health - 21); impact(game.p2.x, game.p2.y, game.p1.face); upd(); }
      }
    });
    kickBtn.addEventListener('touchstart', e => { e.preventDefault();
      if (!game.over && game.p1.kick === 0) {
        game.p1.kick = 35; document.getElementById('kickSfx').play();
        if (hit(game.p1, game.p2)) { game.p2.health = Math.max(0, game.p2.health - 29); impact(game.p2.x, game.p2.y, game.p1.face); upd(); }
      }
    });

    // JOYSTICK
    let joyCenter = {};
    joystick.addEventListener('touchstart', e => {
      e.preventDefault(); game.joy.active = true;
      const r = e.target.getBoundingClientRect();
      joyCenter = { x: r.left + 80, y: r.top + 80 };
    });
    document.addEventListener('touchmove', e => {
      if (game.joy.active) {
        const t = e.touches[0];
        const dx = t.clientX - joyCenter.x, dy = t.clientY - joyCenter.y;
        const dist = Math.min(65, Math.hypot(dx, dy));
        const ang = Math.atan2(dy, dx);
        game.joy.dx = dist / 65 * Math.cos(ang);
        knob.style.transform = `translate(${dx * 0.9}px, ${dy * 0.9}px)`;
      }
    });
    document.addEventListener('touchend', () => {
      if (game.joy.active) {
        game.joy.active = false; game.joy.dx = 0;
        knob.style.transform = 'translate(-50%, -50%)';
      }
    });

    // START + FULLSCREEN
    startBtn.onclick = () => {
      goFullscreen();
      setTimeout(() => {
        startScreen.style.display = 'none';
        ui.style.display = 'flex';
        controls.style.display = 'flex';
        joystick.style.display = 'block';
        upd();
        loop();
      }, 300);
    };

    // RESTART
    restartBtn.onclick = () => {
      game.p1 = { x: 500, y: game.groundY, health: 100, face: 'right', punch: 0, kick: 0 };
      game.p2 = { x: 1920 - 600, y: game.groundY, health: 100, face: 'left', punch: 0, kick: 0 };
      game.particles = []; game.over = false;
      upd(); gameOver.style.display = 'none';
    };
  </script>
</body>
</html>
